<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARCHON - Where Art, Value, and Legacy Are Preserved</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background-color: #000;
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Navigation */
        nav {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 300;
            letter-spacing: 0.3em;
            cursor: pointer;
            user-select: none;
        }
        
        .nav-buttons {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 24px;
            font-size: 14px;
            font-weight: 300;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            color: #fff;
            white-space: nowrap;
        }
        
        .btn:hover {
            opacity: 0.8;
        }
        
        .btn-primary {
            background-color: #fff;
            color: #000;
        }
        
        .btn-secondary {
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .btn-large {
            padding: 16px 40px;
            font-size: 14px;
            min-width: 200px;
        }
        
        /* Hero Section */
        .hero {
            min-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            padding: 40px 20px;
        }
        
        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 900px;
        }
        
        h1 {
            font-size: clamp(48px, 8vw, 96px);
            font-weight: 300;
            letter-spacing: 0.2em;
            margin-bottom: 24px;
        }
        
        .hero-subtitle {
            font-size: clamp(18px, 3vw, 24px);
            color: rgba(255,255,255,0.7);
            margin-bottom: 16px;
            font-weight: 300;
        }
        
        .hero-description {
            font-size: 18px;
            color: rgba(255,255,255,0.5);
            max-width: 700px;
            margin: 0 auto 48px;
            line-height: 1.6;
        }
        
        .hero-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.9);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: rgb(9, 9, 11);
            border: 1px solid rgba(255,255,255,0.1);
            max-width: 480px;
            width: 100%;
            position: relative;
            padding: 40px;
            margin: auto;
        }
        
        .modal-close {
            position: absolute;
            top: 24px;
            right: 24px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.4);
            cursor: pointer;
            font-size: 24px;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: #fff;
        }
        
        .modal h2 {
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 8px;
            letter-spacing: 0.05em;
        }
        
        .modal > div > p {
            color: rgba(255,255,255,0.5);
            font-size: 14px;
            margin-bottom: 32px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-size: 14px;
            color: rgba(255,255,255,0.6);
            margin-bottom: 8px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            background-color: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: rgba(255,255,255,0.3);
        }
        
        .vault-type-option {
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            margin-bottom: 16px;
        }
        
        .vault-type-option:hover {
            border-color: rgba(255,255,255,0.2);
        }
        
        .vault-type-option.selected {
            border-color: rgba(255,255,255,0.3);
            background-color: rgba(255,255,255,0.05);
        }
        
        .vault-type-option h3 {
            font-size: 18px;
            font-weight: 300;
            margin-bottom: 8px;
        }
        
        .vault-type-option p {
            font-size: 14px;
            color: rgba(255,255,255,0.6);
            margin: 0;
        }
        
        .alert {
            padding: 12px 16px;
            margin-bottom: 20px;
            border-left: 3px solid;
            font-size: 14px;
        }
        
        .alert-error {
            background-color: rgba(239, 68, 68, 0.1);
            border-color: rgb(239, 68, 68);
            color: rgb(252, 165, 165);
        }
        
        .vault {
            display: none;
            min-height: 100vh;
        }
        
        .vault.active {
            display: block;
        }
        
        .vault-header {
            padding: 48px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .vault-header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap;
            gap: 24px;
        }
        
        .vault-info h2 {
            font-size: 36px;
            font-weight: 300;
            margin-bottom: 8px;
        }
        
        .vault-stats {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
        }
        
        .empty-state {
            text-align: center;
            padding: 120px 20px;
        }
        
        .empty-state h3 {
            font-size: 24px;
            font-weight: 300;
            margin-bottom: 8px;
            margin-top: 24px;
        }
        
        .empty-state p {
            color: rgba(255,255,255,0.5);
            margin-bottom: 32px;
        }
        
        .success-check {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background-color: rgba(74, 222, 128, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgb(74, 222, 128);
            font-size: 32px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: rgba(255,255,255,0.6);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">
            <div class="spinner"></div>
            <p style="color: rgba(255,255,255,0.6);">Loading ARCHON...</p>
        </div>
    </div>

    <!-- Load Supabase from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>

    <script>
        // Wait for DOM and Supabase to load
        (function() {
            'use strict';
            
            console.log('ARCHON initializing...');

            // Check if Supabase loaded
            if (typeof window.supabase === 'undefined') {
                console.error('Supabase failed to load');
                document.getElementById('app').innerHTML = `
                    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 16px; padding: 20px; text-align: center;">
                        <p style="color: #ef4444; font-size: 18px;">Failed to load required libraries.</p>
                        <p style="color: rgba(255,255,255,0.6); font-size: 14px;">Please refresh the page or check your internet connection.</p>
                    </div>
                `;
                return;
            }

            // Initialize Supabase
            const supabase = window.supabase.createClient(
                'https://jcyoxdtdihgpxsrpfufs.supabase.co',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjeW94ZHRkaWhncHhzcnBmdWZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzgwOTM1NzIsImV4cCI6MjA1MzY2OTU3Mn0.x-V7pOq4E3OLQmJB6jJwEyL9oCGXlb8vDGN1N3bPl4M'
            );

            console.log('Supabase initialized');

            // Global state
            let state = {
                user: null,
                profile: null,
                loading: true,
                view: 'landing',
                signupStep: 1,
                selectedVaultType: null,
                signupData: {}
            };

            // Initialize app
            async function init() {
                try {
                    const { data: { session } } = await supabase.auth.getSession();
                    
                    if (session) {
                        state.user = session.user;
                        await loadUserProfile();
                        state.view = 'vault';
                    }
                    
                    state.loading = false;
                    render();

                    // Auth listener
                    supabase.auth.onAuthStateChange(async (event, session) => {
                        console.log('Auth state changed:', event);
                        if (session) {
                            state.user = session.user;
                            await loadUserProfile();
                            state.view = 'vault';
                        } else {
                            state.user = null;
                            state.profile = null;
                            state.view = 'landing';
                        }
                        render();
                    });
                } catch (error) {
                    console.error('Init error:', error);
                    state.loading = false;
                    render();
                }
            }

            async function loadUserProfile() {
                if (!state.user) return;
                
                try {
                    const { data } = await supabase
                        .from('profiles')
                        .select('*')
                        .eq('id', state.user.id)
                        .single();
                    
                    if (data) {
                        state.profile = data;
                    }
                } catch (error) {
                    console.error('Profile load error:', error);
                }
            }

            // Make functions global so onclick works
            window.showLanding = function() {
                state.view = 'landing';
                render();
            };

            window.showVault = function() {
                if (!state.user) {
                    window.openLogin();
                    return;
                }
                state.view = 'vault';
                render();
            };

            window.openSignup = function() {
                state.signupStep = 1;
                state.selectedVaultType = null;
                state.signupData = {};
                const modal = document.getElementById('signupModal');
                if (modal) modal.classList.add('active');
            };

            window.closeSignup = function() {
                const modal = document.getElementById('signupModal');
                if (modal) modal.classList.remove('active');
                state.signupStep = 1;
                state.selectedVaultType = null;
            };

            window.openLogin = function() {
                const modal = document.getElementById('loginModal');
                if (modal) modal.classList.add('active');
            };

            window.closeLogin = function() {
                const modal = document.getElementById('loginModal');
                if (modal) modal.classList.remove('active');
            };

            window.handleLogout = async function() {
                try {
                    await supabase.auth.signOut();
                    state.user = null;
                    state.profile = null;
                    state.view = 'landing';
                    render();
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Error logging out. Please try again.');
                }
            };

            window.handleSignupStep1 = function(e) {
                e.preventDefault();
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                
                state.signupData = { name, email, password };
                state.signupStep = 2;
                renderSignupContent();
            };

            window.backToSignupStep1 = function() {
                state.signupStep = 1;
                renderSignupContent();
            };

            window.selectVaultType = function(type) {
                state.selectedVaultType = type;
                const options = document.querySelectorAll('.vault-type-option');
                options.forEach(opt => {
                    if (opt.textContent.toLowerCase().includes(type)) {
                        opt.classList.add('selected');
                    } else {
                        opt.classList.remove('selected');
                    }
                });
                const btn = document.getElementById('createVaultBtn');
                if (btn) btn.disabled = false;
            };

            window.createAccount = async function() {
                const { name, email, password } = state.signupData;
                const errorEl = document.getElementById('signupError');
                
                if (errorEl) errorEl.classList.add('hidden');

                try {
                    const { data: authData, error: authError } = await supabase.auth.signUp({
                        email,
                        password,
                        options: {
                            data: {
                                full_name: name,
                                vault_type: state.selectedVaultType
                            }
                        }
                    });

                    if (authError) throw authError;

                    if (authData.user) {
                        const { error: profileError } = await supabase
                            .from('profiles')
                            .insert([{
                                id: authData.user.id,
                                full_name: name,
                                vault_type: state.selectedVaultType,
                                plan_tier: 'starter',
                                asset_count: 0,
                                storage_used: 0
                            }]);

                        if (profileError && profileError.code !== '23505') {
                            console.error('Profile error:', profileError);
                        }
                    }

                    state.signupStep = 3;
                    renderSignupContent();

                    setTimeout(() => {
                        window.closeSignup();
                        state.view = 'vault';
                        render();
                    }, 3000);

                } catch (error) {
                    console.error('Signup error:', error);
                    if (errorEl) {
                        errorEl.textContent = error.message || 'An error occurred during signup';
                        errorEl.classList.remove('hidden');
                    }
                }
            };

            window.handleLogin = async function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const errorEl = document.getElementById('loginError');
                
                if (errorEl) errorEl.classList.add('hidden');

                try {
                    const { error } = await supabase.auth.signInWithPassword({
                        email,
                        password
                    });

                    if (error) throw error;

                    window.closeLogin();
                    await loadUserProfile();
                    state.view = 'vault';
                    render();

                } catch (error) {
                    console.error('Login error:', error);
                    if (errorEl) {
                        errorEl.textContent = error.message || 'Invalid email or password';
                        errorEl.classList.remove('hidden');
                    }
                }
            };

            window.switchToSignup = function(e) {
                e.preventDefault();
                window.closeLogin();
                window.openSignup();
            };

            window.uploadAsset = function() {
                alert('Asset upload coming soon!\n\nThis feature will let you:\n• Upload high-res images\n• Add detailed documentation\n• Track provenance\n• Generate certificates\n\nFor now, enjoy exploring your vault!');
            };

            function renderSignupContent() {
                const step1 = document.getElementById('signupStep1');
                const step2 = document.getElementById('signupStep2');
                const step3 = document.getElementById('signupStep3');

                if (step1) step1.classList.toggle('active', state.signupStep === 1);
                if (step2) step2.classList.toggle('active', state.signupStep === 2);
                if (step3) step3.classList.toggle('active', state.signupStep === 3);
            }

            function render() {
                const app = document.getElementById('app');
                
                if (state.loading) {
                    return; // Keep loading spinner
                }

                const isLoggedIn = !!state.user;

                app.innerHTML = `
                    <nav>
                        <div class="container">
                            <div class="logo" onclick="showLanding()">ARCHON</div>
                            <div class="nav-buttons">
                                ${isLoggedIn ? `
                                    <span style="font-size: 14px; color: rgba(255,255,255,0.5);">${state.user.email}</span>
                                    <button class="btn" onclick="showVault()">My Vault</button>
                                    <button class="btn btn-secondary" onclick="handleLogout()">Sign Out</button>
                                ` : `
                                    <button class="btn" onclick="openLogin()">Sign In</button>
                                    <button class="btn btn-primary" onclick="openSignup()">Start Free</button>
                                `}
                            </div>
                        </div>
                    </nav>

                    ${state.view === 'landing' ? `
                        <div class="hero">
                            <div class="hero-content">
                                <h1>ARCHON</h1>
                                <p class="hero-subtitle">Where Art, Value, and Legacy Are Preserved</p>
                                <p class="hero-description">
                                    The first digital vault built for creative works and valuable collections.
                                    Not social media. Not cloud storage. A permanent, professional record of what matters most.
                                </p>
                                <div class="hero-buttons">
                                    <button class="btn btn-primary btn-large" onclick="openSignup()">Start Free — 5 Assets</button>
                                    <button class="btn btn-secondary btn-large" onclick="alert('Full pricing details coming soon!')">View Pricing</button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    ${state.view === 'vault' && isLoggedIn ? `
                        <div class="vault active">
                            <section class="vault-header">
                                <div class="container">
                                    <div class="vault-header-content">
                                        <div class="vault-info">
                                            <h2>${state.profile?.vault_type === 'creator' ? 'Creative Vault' : 'Collection Vault'}</h2>
                                            <p class="vault-stats">
                                                ${state.profile?.asset_count || 0} of ${state.profile?.plan_tier === 'starter' ? '5' : '∞'} assets · 
                                                ${(state.profile?.plan_tier || 'starter').toUpperCase()} Plan
                                            </p>
                                        </div>
                                        <button class="btn btn-primary" onclick="uploadAsset()">+ NEW ASSET</button>
                                    </div>
                                </div>
                            </section>
                            <section class="container" style="padding: 48px 20px;">
                                <div class="empty-state">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    </svg>
                                    <h3>Your vault is empty</h3>
                                    <p>Upload your first asset to get started</p>
                                    <button class="btn btn-primary" onclick="uploadAsset()">UPLOAD FIRST ASSET</button>
                                </div>
                            </section>
                        </div>
                    ` : ''}

                    <div id="signupModal" class="modal">
                        <div class="modal-content">
                            <button class="modal-close" onclick="closeSignup()">×</button>
                            
                            <div id="signupStep1" class="step active">
                                <h2>Create Your Account</h2>
                                <p>Start preserving your assets today. Free forever.</p>
                                
                                <div id="signupError" class="alert alert-error hidden"></div>
                                
                                <form onsubmit="handleSignupStep1(event)">
                                    <div class="form-group">
                                        <label>Full Name</label>
                                        <input type="text" id="signupName" required placeholder="John Doe">
                                    </div>
                                    <div class="form-group">
                                        <label>Email Address</label>
                                        <input type="email" id="signupEmail" required placeholder="john@example.com">
                                    </div>
                                    <div class="form-group">
                                        <label>Password</label>
                                        <input type="password" id="signupPassword" required minlength="8" placeholder="Minimum 8 characters">
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 8px;">Continue</button>
                                </form>
                            </div>

                            <div id="signupStep2" class="step">
                                <h2>Choose Your Vault Type</h2>
                                <p>This helps us customize your experience.</p>
                                
                                <div class="vault-type-option" onclick="selectVaultType('creator')">
                                    <h3>Creator Vault</h3>
                                    <p>For artists, photographers, designers documenting their work.</p>
                                </div>
                                <div class="vault-type-option" onclick="selectVaultType('collector')">
                                    <h3>Collector Vault</h3>
                                    <p>For collectors of art, watches, wine, and valuable assets.</p>
                                </div>
                                
                                <button id="createVaultBtn" class="btn btn-primary" style="width: 100%;" disabled onclick="createAccount()">Create My Vault</button>
                                <button class="btn btn-secondary" style="width: 100%; margin-top: 12px;" onclick="backToSignupStep1()">Back</button>
                            </div>

                            <div id="signupStep3" class="step">
                                <div class="success-check">✓</div>
                                <h2 style="text-align: center;">Welcome to ARCHON</h2>
                                <p style="text-align: center;">Your vault is ready. Redirecting...</p>
                            </div>
                        </div>
                    </div>

                    <div id="loginModal" class="modal">
                        <div class="modal-content">
                            <button class="modal-close" onclick="closeLogin()">×</button>
                            
                            <h2>Welcome Back</h2>
                            <p>Sign in to access your vault.</p>
                            
                            <div id="loginError" class="alert alert-error hidden"></div>
                            
                            <form onsubmit="handleLogin(event)">
                                <div class="form-group">
                                    <label>Email Address</label>
                                    <input type="email" id="loginEmail" required placeholder="john@example.com">
                                </div>
                                <div class="form-group">
                                    <label>Password</label>
                                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 8px;">Sign In</button>
                                <p style="text-align: center; font-size: 14px; color: rgba(255,255,255,0.5); margin-top: 16px;">
                                    Don't have an account? 
                                    <a href="#" onclick="switchToSignup(event)" style="color: #fff; text-decoration: underline; cursor: pointer;">Sign up free</a>
                                </p>
                            </form>
                        </div>
                    </div>
                `;
            }

            // Start app
            init();

            console.log('ARCHON initialized successfully');
        })();
    </script>
</body>
</html>
